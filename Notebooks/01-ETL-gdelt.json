{"paragraphs":[{"text":"import sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection \nimport org.apache.spark.sql.functions._\n\n\ndef fileDownloader(urlOfFileToDownload: String, fileName: String) = {\n    val url = new URL(urlOfFileToDownload)\n    val connection = url.openConnection().asInstanceOf[HttpURLConnection]\n    connection.setConnectTimeout(5000)\n    connection.setReadTimeout(5000)\n    connection.connect()\n\n    if (connection.getResponseCode >= 400)\n        println(\"error\")\n    else\n        url #> new File(fileName) !!\n}","user":"anonymous","dateUpdated":"2020-01-23T22:24:01+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one feature warning; re-run with -feature for details\nimport sys.process._\nimport java.net.URL\nimport java.io.File\nimport java.io.File\nimport java.nio.file.{Files, StandardCopyOption}\nimport java.net.HttpURLConnection\nimport org.apache.spark.sql.functions._\nfileDownloader: (urlOfFileToDownload: String, fileName: String)Any\n"}]},"apps":[],"jobName":"paragraph_1579741225750_1769111356","id":"20200117-084853_890706269","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:24:01+0000","dateFinished":"2020-01-23T22:24:01+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4618"},{"text":"fileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist.txt\", \"/mnt/tmp/masterfilelist.txt\") // save the list file to the Spark Master\nfileDownloader(\"http://data.gdeltproject.org/gdeltv2/masterfilelist-translation.txt\", \"/mnt/tmp/masterfilelist-translation.txt\")","user":"anonymous","dateUpdated":"2020-01-23T22:24:05+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"res8: Any = \"\"\n"}]},"apps":[],"jobName":"paragraph_1579741225750_-659320050","id":"20200117-084912_1192902524","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:24:05+0000","dateFinished":"2020-01-23T22:24:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4619"},{"text":"import com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\n    \nval AWS_ID = \"AKIAS4U3P2UU5U4JOWXX\"\nval AWS_KEY = \"KIsg3ZwFTBsw36IgOK/+UqNtOK8pTVS/cMrId/yH\"\n// la classe AmazonS3Client n'est pas serializable\n// on rajoute l'annotation @transient pour dire a Spark de ne pas essayer de serialiser cette classe et l'envoyer aux executeurs\n@transient val awsClient = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n\nsc.hadoopConfiguration.set(\"fs.s3a.access.key\", AWS_ID) // mettre votre ID du fichier credentials.csv\nsc.hadoopConfiguration.set(\"fs.s3a.secret.key\", AWS_KEY) // mettre votre secret du fichier credentials.csv\n\nawsClient.putObject(\"fpsx-telecom-gdelt2019\", \"masterfilelist.txt\", new File( \"/mnt/tmp/masterfilelist.txt\") )\nawsClient.putObject(\"fpsx-telecom-gdelt2019\", \"masterfilelist-translation.txt\", new File( \"/mnt/tmp/masterfilelist-translation.txt\") )","user":"anonymous","dateUpdated":"2020-01-23T22:24:10+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nimport com.amazonaws.services.s3.AmazonS3Client\nimport com.amazonaws.auth.BasicAWSCredentials\nAWS_ID: String = AKIAS4U3P2UU5U4JOWXX\nAWS_KEY: String = KIsg3ZwFTBsw36IgOK/+UqNtOK8pTVS/cMrId/yH\nawsClient: com.amazonaws.services.s3.AmazonS3Client = com.amazonaws.services.s3.AmazonS3Client@fea9049\nres9: com.amazonaws.services.s3.model.PutObjectResult = com.amazonaws.services.s3.model.PutObjectResult@5ff621ed\n"}]},"apps":[],"jobName":"paragraph_1579741225750_973981382","id":"20200122-175936_1523528327","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:24:10+0000","dateFinished":"2020-01-23T22:24:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4620"},{"text":"import org.apache.spark.sql.SQLContext\n\nval sqlContext = new SQLContext(sc)\nval filesDF = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://fpsx-telecom-gdelt2019/masterfilelist.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\").\n                    cache\n\nval filesTransDF = sqlContext.read.\n                    option(\"delimiter\",\" \").\n                    option(\"infer_schema\",\"true\").\n                    csv(\"s3a://fpsx-telecom-gdelt2019/masterfilelist-translation.txt\").\n                    withColumnRenamed(\"_c0\",\"size\").\n                    withColumnRenamed(\"_c1\",\"hash\").\n                    withColumnRenamed(\"_c2\",\"url\").\n                    cache","user":"anonymous","dateUpdated":"2020-01-23T22:24:13+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\nimport org.apache.spark.sql.SQLContext\nsqlContext: org.apache.spark.sql.SQLContext = org.apache.spark.sql.SQLContext@516e14b5\nfilesDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nfilesTransDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579741225751_1517574305","id":"20200122-175732_1893288632","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:24:13+0000","dateFinished":"2020-01-23T22:24:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4621"},{"text":"val sampleDF = filesDF.filter(col(\"url\").contains(\"/201912\")).cache\nval sampleTransDF = filesTransDF.filter(col(\"url\").contains(\"/201912\")).cache","user":"anonymous","dateUpdated":"2020-01-23T22:24:17+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"sampleDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\nsampleTransDF: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [size: string, hash: string ... 1 more field]\n"}]},"apps":[],"jobName":"paragraph_1579741225751_-1212555288","id":"20200117-085111_788630888","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:24:17+0000","dateFinished":"2020-01-23T22:24:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4622"},{"text":"object AwsClient{\n    val s3 = new AmazonS3Client(new BasicAWSCredentials(AWS_ID, AWS_KEY))\n}\n\n\nsampleDF.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(\"fpsx-telecom-gdelt2019\", fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2020-01-23T22:28:51+0000","config":{"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/scala","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":93.15,"optionOpen":false}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"warning: there was one deprecation warning; re-run with -deprecation for details\ndefined object AwsClient\n"}]},"apps":[],"jobName":"paragraph_1579741225751_998361517","id":"20200117-085141_1090087684","dateCreated":"2020-01-23T01:00:25+0000","dateStarted":"2020-01-23T22:28:51+0000","dateFinished":"2020-01-23T22:45:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4623"},{"text":"sampleTransDF.select(\"url\").repartition(100).foreach( r=> {\n            val URL = r.getAs[String](0)\n            val fileName = r.getAs[String](0).split(\"/\").last\n            val dir = \"/mnt/tmp/\"\n            val localFileName = dir + fileName\n            fileDownloader(URL,  localFileName)\n            val localFile = new File(localFileName)\n            AwsClient.s3.putObject(\"fpsx-telecom-gdelt2019\", fileName, localFile )\n            localFile.delete()\n            \n})","user":"anonymous","dateUpdated":"2020-01-23T23:22:56+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1579782808625_2084230133","id":"20200123-123328_142279113","dateCreated":"2020-01-23T12:33:28+0000","dateStarted":"2020-01-23T23:22:56+0000","dateFinished":"2020-01-23T23:50:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:4624"}],"name":"01-ETL-gdelt","id":"2F18EVDBB","noteParams":{},"noteForms":{},"angularObjects":{"md:shared_process":[],"python:shared_process":[],"sh:shared_process":[],"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}